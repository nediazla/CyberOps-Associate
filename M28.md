# Módulo 28. Análisis Forense, Respuesta y Gestión de Incidencias (visión SOC)

Este módulo cubre:

1. Respuesta a incidentes (NIST 800-61)
    
2. Análisis forense digital
    
3. Preservación y cadena de custodia
    
4. Recolección de evidencia
    
5. Análisis de memoria, disco y red
    
6. Análisis de malware básico
    
7. Contención, erradicación y recuperación
    
8. Documentación e informes
    
9. Lecciones aprendidas
    

---

# 1. Respuesta a Incidentes (NIST 800-61)

Fases:

### 1. Preparación

- Playbooks
    
- Baselines
    
- Controles
    
- Herramientas
    
- Acceso a SIEM/EDR
    
- Procedimientos de escalado
    

### 2. Detección y Análisis

- Se recibe una alerta
    
- Se validan logs
    
- Se identifica el tipo de incidente
    
- Se clasifica severidad
    

### 3. Contención

- Aislar host
    
- Bloquear IP/dominio
    
- Revocar credenciales
    
- Deshabilitar servicios
    
- Suspender procesos
    
- Cortar túneles
    

### 4. Erradicación

- Eliminar malware
    
- Borrar persistencia
    
- Cerrar vulnerabilidades
    
- Rotar claves
    
- Eliminar usuarios creados
    

### 5. Recuperación

- Restaurar sistemas
    
- Validar integridad
    
- Monitorear posible reinfección
    

### 6. Lecciones aprendidas

- Mejorar reglas del SIEM
    
- Actualizar playbooks
    
- Ajustar configuraciones
    
- Añadir nuevos controles
    

---

# 2. Análisis Forense Digital

El análisis forense busca:

- qué ocurrió
    
- quién lo hizo
    
- cómo lo hizo
    
- qué impacto tuvo
    
- qué evidencia existe
    

La clave es **no alterar evidencia**.

---

# 3. Cadena de Custodia

Reglas fundamentales:

- registrar quién accede a la evidencia
    
- registrar tiempos y acciones
    
- no modificar archivos originales
    
- usar hashes (SHA-256) para verificar integridad
    
- almacenar en contenedores seguros
    

Toda evidencia debe poder usarse en investigación legal.

---

# 4. Recolección de Evidencia

Tipos de evidencia:

### 4.1 Evidencia volátil (RAM)

Se pierde al apagar:

- procesos
    
- conexiones
    
- claves en memoria
    
- malware fileless
    
- inyección en procesos
    

Herramientas verificables:

- **FTK Imager**
    
- **KAPE**
    
- **LiME (Linux Memory Extractor)**
    

### 4.2 Evidencia no volátil (disco)

- archivos
    
- logs
    
- artefactos de usuario
    
- historial de comandos
    
- binarios sospechosos
    

Herramientas:

- dd
    
- Autopsy
    
- Sleuth Kit
    

### 4.3 Evidencia de red

- NetFlow
    
- PCAP
    
- Zeek logs
    
- Firewall logs
    

---

# 5. Análisis de Memoria

Se usa para detectar:

- procesos ocultos
    
- malware inyectado
    
- hooks en kernel
    
- conexiones abiertas
    
- DLLs sospechosas
    

Herramienta estándar: **Volatility** (verificable).

Ejemplo:

`volatility -f memdump.raw pslist volatility -f memdump.raw netscan`

---

# 6. Análisis de Disco

Incluye:

- timeline
    
- persistencia
    
- artefactos de usuario
    
- historial de navegador
    
- archivos eliminados
    
- MFT (Master File Table en NTFS)
    

Método:

1. Crear imagen
    
2. Calcular hash
    
3. Analizar con herramientas
    
4. No alterar evidencias
    

Herramientas:

- Autopsy
    
- Sleuth Kit
    
- plaso/log2timeline
    

---

# 7. Artefactos Forenses en Windows

Muy importantes para CyberOps:

- Prefetch
    
- ShimCache
    
- AmCache
    
- Registry (Run, Services)
    
- Scheduled Tasks
    
- Event Logs
    
- RecentFiles
    
- Browser History
    
- LNK files
    

---

# 8. Artefactos Forenses en Linux

Claves:

- /var/log/auth.log
    
- .bash_history
    
- ~/.ssh/authorized_keys
    
- /var/log/syslog
    
- cron jobs
    
- systemd services
    
- archivos modificados recientemente
    

---

# 9. Análisis Forense de Red

Con PCAP, Flow y Zeek se detecta:

- explotación
    
- payloads maliciosos
    
- beaconing
    
- exfiltración
    
- C2
    
- scanning
    
- túneles
    
- manipulación de protocolos
    

Ejemplos verificables:

- Zeek conn.log (movimiento lateral)
    
- dns.log (tunneling)
    
- ssl.log (certificados raros)
    

---

# 10. Análisis de Malware (básico)

Dos enfoques:

## 10.1 Estático

Sin ejecutar el malware.

- hash
    
- cadenas
    
- imports
    
- PE header
    
- ofuscación
    
- empaquetadores
    

Herramientas:

- strings
    
- ExifTool
    
- PEStudio
    
- VirusTotal
    

## 10.2 Dinámico

Ejecutar en entorno controlado (sandbox).

- comportamiento
    
- procesos
    
- conexiones
    
- archivos creados
    

Herramientas:

- Cuckoo Sandbox
    
- AnyRun
    
- CAPE
    

---

# 11. Reconstrucción del incidente (timeline)

Es el arte de “contar la historia” del ataque.

Ejemplo:

1. phishing →
    
2. ejecución de macro →
    
3. powershell codificado →
    
4. contacto con C2 →
    
5. descarga de payload →
    
6. movimiento lateral →
    
7. exfiltración
    

Se construye con:

- logs
    
- flow
    
- PCAP
    
- EDR
    
- artefactos del host
    

---

# 12. Comunicación y reporte

El SOC debe escribir un informe claro:

- descripción del incidente
    
- qué ocurrió
    
- impacto
    
- qué sistemas afectados
    
- qué acciones se tomaron
    
- recomendaciones
    
- riesgos actuales
    
- estado final
    

El informe debe ser verificable, reproducible y basado en evidencia.

---

# 13. Lecciones aprendidas

Después del incidente:

- actualizar detecciones
    
- mejorar reglas de firewall
    
- reforzar políticas
    
- entrenar usuarios
    
- revisar arquitectura
    
- corregir fallos de hardening
    
- añadir nuevas capacidades (EDR, SIEM, Sysmon…)
    

Muchos SOC mejoran después de un incidente.

---

# 14. MITRE ATT&CK asociado

Este módulo engloba gran parte de MITRE, pero destacan:

- **T1059 – Execution**
    
- **T1071 – Command & Control**
    
- **T1041 – Exfiltration**
    
- **T1003 – Credential Dumping**
    
- **T1547 – Persistence**
    
- **T1574 – Hijacking**
    
- **T1083 – Discovery**
    
- **T1021 – Lateral Movement**
    
- **T1490 – Inhibit System Recovery**
    

---

# 15. ¿Qué debe dominar un analista al terminar este módulo?

- Extraer evidencia sin modificarla
    
- Entender cadena de custodia
    
- Analizar memoria con Volatility
    
- Analizar disco con Autopsy/Sleuth Kit
    
- Analizar PCAP y Zeek logs
    
- Identificar persistencia en Windows y Linux
    
- Reconstruir un incidente
    
- Detectar C2 y exfiltración
    
- Redactar informes de incidentes
    
- Aplicar playbooks de respuesta
    
- Entender forense básico de malware
    
- Ejecutar contención y erradicación