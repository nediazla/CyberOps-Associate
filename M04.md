# Módulo 4. Sistema Operativo Linux (visión SOC)

El analista SOC debe entender Linux como un ecosistema transparente y auditable: procesos, permisos, logs, servicios, autenticaciones y archivos dejan huellas permanentes. En entornos reales, Linux domina en servidores, contenedores y servicios críticos.

---

## 1. Arquitectura general de Linux

El módulo se apoya en:

- **Kernel**: controla procesos, memoria, drivers, red.
    
- **User space**: el resto del sistema: comandos, demonios, shells.
    
- **Init system**: clásico SysVinit o moderno **systemd**.
    
- **FHS (Filesystem Hierarchy Standard)**: estructura de directorios.
    

Rutas críticas para seguridad:

- /etc/passwd
    
- /etc/shadow
    
- /etc/group
    
- /var/log/
    
- /etc/sudoers
    
- /etc/ssh/ssh_config
    
- /etc/ssh/sshd_config
    

---

## 2. Usuarios, grupos, permisos y sudo

En Linux, todo es un archivo, así que los permisos se vuelven señales de intrusión.

Usuarios importantes:

- root
    
- daemon
    
- nobody
    

Ataques típicos:

- Creación de usuarios persistentes
    
- Manipulación de /etc/sudoers
    
- Configuraciones débiles en SSH
    

Archivos clave:

- **/etc/passwd**: lista de usuarios, información de shell
    
- **/etc/shadow**: hashes SHA512 (por defecto en Ubuntu y Debian)
    
- **/etc/group**: grupos
    
- **/etc/sudoers**: privilegios elevados
    

Un atacante puede:

- Añadir usuario
    
- Cambiar el shell por /bin/bash
    
- Añadirlo al grupo sudo
    
- Crear claves SSH en ~/.ssh/authorized_keys
    

Todo esto deja logs.

---

## 3. Procesos y servicios

El analista SOC debe reconocer procesos legítimos:

Procesos típicos:

- systemd
    
- sshd
    
- cron
    
- rsyslog
    
- journald
    
- apache2 / nginx
    
- mysqld
    

Señales de alerta:

- Procesos ejecutándose desde /tmp o /dev/shm
    
- Scripts en bash en ejecución anómala
    
- Servicios nuevos en systemd
    
- Procesos que se respawnean continuamente
    

Comandos verificables:

```
ps aux
top
htop
systemctl list-units --type=service
systemctl status nombre_servicio
```

---

## 4. Directorios críticos y señales forenses

El analista SOC debe vigilar:

### /tmp y /dev/shm

Zonas temporales donde malware se esconde.  
Scripts sospechosos suelen aparecer allí.

### /var/spool/cron

Persistencia mediante cronjobs.

### ~/.ssh

Claves públicas no autorizadas.

### /etc/systemd/system

Servicios nuevos creados por atacantes.

### /var/log

Oráculo del SOC: syslog, auth.log, journal.

---

## 5. Logs en Linux (el corazón del análisis SOC)

Los logs varían entre distros pero mantienen el mismo espíritu.

### Syslog (Ubuntu, Debian)

Rutas típicas:

- **/var/log/syslog**
    
- **/var/log/auth.log**
    
- /var/log/kern.log
    
- /var/log/dpkg.log
    

### RHEL/CentOS/Fedora

- /var/log/messages
    
- /var/log/secure
    

### journald

Comando:

```
journalctl
journalctl -u ssh
journalctl --since "1 hour ago"
journalctl -p err
```

### Eventos críticos:

Autenticación:

- SSH failed login → “Failed password”
    
- SSH success → “Accepted password/publickey”
    
- Sudo → “sudo: pam_unix(sudo:session): session opened/closed”
    

Manipulación de usuarios:

- useradd
    
- passwd
    
- groupmod
    

Servicios:

- systemd notices
    
- “Service started” / “Service stopped”
    
- “Unit failed”
    

Instalación de paquetes:

- apt, dnf, yum → logs confirmables en /var/log/dpkg.log, /var/log/yum.log
    

---

## 6. Auditd: telemetría avanzada

Auditd es el equivalente Linux de Sysmon en Windows.  
Verificable en la documentación oficial de Audit Framework.

Auditd permite monitorear:

- Acceso a archivos
    
- Cambios de permisos
    
- Ejecuciones
    
- Llamadas al sistema
    
- Actividad de root
    

Ejemplo de regla:

```
-w /etc/passwd -p wa -k passwd_changes
```

Comandos:

```
auditctl -l
ausearch -k passwd_changes
aureport --summary
```

---

## 7. SSH: puerta de entrada y vector de ataque

Configuración crítica:  
/etc/ssh/sshd_config

Puntos importantes:

- PasswordAuthentication
    
- PermitRootLogin
    
- PublicKeyAuthentication
    
- LogLevel VERBOSE
    

Ataques típicos:

- Fuerza bruta
    
- Uso de claves robadas
    
- Túneles inversos
    
- Persistencia mediante authorized_keys
    

Logs verificables en: /var/log/auth.log

---

## 8. Comandos de administración relevantes para SOC

Cada uno observable y verificable.

### Información de la red:

```
ip a
ip r
ss -tulpn
netstat -ano
```

### Búsqueda de archivos sospechosos:

```
find / -perm -4000 2>/dev/null
find / -type f -mtime -1
```

### Hashes:

```
sha256sum archivo
sha1sum archivo
```

### Integridad:

```
rpm -V paquete       # en sistemas RPM
debsums -s paquete   # en Debian/Ubuntu
```

### Permisos:

```
ls -la
stat archivo
```

---

## 9. Persistencia en Linux (MITRE ATT&CK)

Casos verificados en MITRE ATT&CK:

- **Cron jobs** (T1053.003)
    
- **Systemd services** (T1543.002)
    
- **SSH authorized_keys** (T1098.004)
    
- **LD_PRELOAD hijacking** (T1574.006)
    
- **Profile / .bashrc modifications** (T1546.004)
    
- **Kernel module loading** (T1547.006)
    

Los atacantes crean persistencia silenciosa modificando:

- /etc/crontab
    
- ~/.bashrc
    
- /etc/profile
    
- /etc/systemd/system/servicio.service
    

---

## 10. Técnicas MITRE ATT&CK asociadas

Las más típicas para análisis SOC en Linux:

- **T1059.004**: ejecución en bash
    
- **T1036**: masquerading
    
- **T1070**: borrar logs
    
- **T1053**: cron
    
- **T1553**: falsificación de binarios
    
- **T1003.008**: lectura de /etc/shadow (credential dumping)
    
- **T1548.003**: explotación de sudo
    

---

## 11. Señales de compromiso en Linux

Un analista debe detectar patrones como:

- Intentos múltiples de SSH
    
- Nuevo usuario sospechoso en /etc/passwd
    
- Entradas nuevas en cron
    
- Binarios en /tmp con permisos de ejecución
    
- Servicios systemd recién creados
    
- Procesos ejecutándose desde rutas no estándar
    
- Conexiones salientes extrañas:
    
    ```
    ss -tulnp | grep :4444
    ```
    
- Historial borrado:  
    – .bash_history vacío  
    – HISTFILE variable modificada
    

---

## 12. Herramientas de análisis en Linux (SOC)

Herramientas verificables y usadas en incident response:

- Auditd / aureport
    
- Sysdig
    
- Falco
    
- Lynis
    
- RKHunter
    
- chkrootkit
    
- psacct / acct
    
- Wazuh Agent
    
- OSQuery
    
- Volatility (memoria)
    
- Sleuthkit (filesystem forensics)
    

---

## 13. ¿Qué analiza un SOC en Linux?

Ejemplos directos y reales:

- Registro de autenticaciones
    
- Cambios en sudoers
    
- Ejecuciones sospechosas en bash
    
- Errores del kernel
    
- Procesos zombies
    
- Servicios que fallan repetidamente
    
- Descargas anómalas con curl o wget
    
- Conexiones netcat / socat
    
- Uso de herramientas ofensivas (nmap, hydra, tcpdump)