# Módulo 22. Protección de Puntos Finales (visión SOC)

Un punto final (endpoint) puede ser:

- Windows
    
- Linux
    
- macOS
    
- Servidor
    
- Laptop
    
- Móvil
    
- VM
    

El objetivo del SOC: **detectar actividad maliciosa en el host antes, durante o después del ataque.**

---

# 1. Antivirus tradicional (EPP)

Características:

- Analiza archivos con firmas
    
- Detecta malware conocido
    
- Bloquea ejecutables sospechosos
    
- Analiza comportamiento básico (heurística)
    

Limitaciones:

- No detecta ataques fileless
    
- No ve técnica avanzada
    
- No analiza relaciones entre eventos
    

---

# 2. EDR (Endpoint Detection & Response)

La herramienta moderna para SOC.

Funciones:

- Monitoreo continuo
    
- Procesos y árboles de procesos
    
- Comportamiento anómalo
    
- Detección de malware fileless
    
- Registro de actividad en memoria
    
- Aislamiento del host
    
- Threat hunting en endpoints
    

Ejemplos verificables:

- Cisco AMP for Endpoints
    
- CrowdStrike Falcon
    
- Microsoft Defender for Endpoint
    
- SentinelOne
    
- Wazuh + Sysmon
    

---

# 3. Árbol de procesos (Process Tree)

El proceso más importante para un analista SOC.

Ejemplo:

`winword.exe → powershell.exe → rundll32.exe → c2.exe`

Señal clara de ataque.

Signos sospechosos:

- Word lanzando PowerShell
    
- Excel lanzando cmd.exe
    
- svchost.exe ejecutando binarios externos
    
- mshta.exe ejecutando JavaScript remoto
    
- wscript.exe descargando payloads
    

---

# 4. Técnicas de ataque en endpoints

### 4.1 Execution (MITRE T1059)

- PowerShell codificado
    
- mshta
    
- rundll32
    
- regsvr32
    
- LOLBins (“Living off the land”)
    

### 4.2 Persistence (T1547)

- Run/RunOnce
    
- Tareas programadas
    
- Servicios nuevos
    
- DLL Hijacking
    
- Cron en Linux
    

### 4.3 Credential Access (T1003)

- Mimikatz
    
- Acceso a LSASS
    
- Keylogging
    
- Dump de sam/ntds.dit
    

### 4.4 Privilege Escalation

- UAC bypass
    
- Kernel exploits
    
- sudo abuso
    

### 4.5 Defense Evasion

- Ofuscación
    
- Firmas falsas
    
- Disable AV/EDR
    
- Bypass AMSI
    

### 4.6 Lateral Movement

- PsExec
    
- SSH lateral
    
- WMI
    
- WinRM
    

### 4.7 Exfiltration

- HTTP/HTTPS
    
- DNS
    
- FTP
    
- Cloud storage
    

---

# 5. Señales SOC en Windows

## Logs importantes:

### Windows Event Log (Security)

- 4624 – Logon
    
- 4625 – Logon failed
    
- 4672 – Privileges assigned
    
- 4688 – New process
    
- 7045 – New service
    
- 1102 – Logs cleared
    
- 4648 – Explicit credentials
    

### PowerShell logs

- EventID 4104 – Script block
    
- EventID 4103 – Command start
    
- EventID 4105 – Module logging
    

### Sysmon (si está instalado)

- EventID 1 – Process creation
    
- EventID 3 – Network connection
    
- EventID 7 – Image loaded
    
- EventID 10 – Access to LSASS
    
- EventID 11 – File create
    
- EventID 12 – Registry event
    

---

# 6. Señales SOC en Linux

Logs clave:

- /var/log/auth.log (SSH login, sudo)
    
- /var/log/syslog
    
- journalctl
    
- auditd logs
    
- systemd service creation
    
- sudo logs
    
- sshd logs
    

Indicadores comunes:

- sudo sin historial
    
- ssh desde IP inusual
    
- cambios en ~/.ssh/authorized_keys
    
- cron jobs nuevos
    
- procesos escuchando en puertos raros
    
- binarios modificados
    

---

# 7. Protección del Endpoint en Linux

Mecanismos verificables:

- SELinux / AppArmor (MAC)
    
- auditd (auditoría)
    
- Fail2ban
    
- ufw / iptables
    
- ClamAV
    
- Wazuh agent
    

---

# 8. Detecciones comunes en endpoints

### Detección de malware

- hash malicioso
    
- heurística
    
- comportamiento extraño
    

### Detección de C2

- tráfico a dominio raro
    
- conexiones periódicas
    
- proceso conectado a IP remota no habitual
    

### Detección de Ransomware

- creación de miles de archivos
    
- extensiones nuevas
    
- destrucción de shadow copies
    

### Detección de phishing

- Word → PowerShell
    
- Excel → macros usando WMI
    
- PDF → ejecución de script
    

### Detección de credenciales robadas

- acceso a LSASS
    
- dump de NTDS
    
- SAM extraído
    

---

# 9. Técnicas de hardening

- Deshabilitar macros
    
- Aplicar MFA
    
- Bloquear PowerShell no firmado
    
- Minimizar privilegios locales
    
- Limitar RDP
    
- Activar Control Flow Guard
    
- Activar ASLR
    
- Mantener parches al día
    
- Verificar integridad de binarios
    

---

# 10. Cómo un SOC usa EDR en respuesta a incidentes

Cuando EDR detecta algo, el SOC puede:

- Aislar host
    
- Matar procesos
    
- Revocar tokens
    
- Eliminar persistencia
    
- Extraer muestras
    
- Hacer triage remoto
    
- Ver historial completo del host
    

---

# 11. MITRE ATT&CK relacionado

- **T1059 – Execution**
    
- **T1003 – Credential Dumping**
    
- **T1547 – Persistence**
    
- **T1134 – Token Abuse**
    
- **T1021 – Remote Services**
    
- **T1041 – Exfiltration**
    
- **T1140 – Obfuscation**
    
- **T1548 – Privilege Escalation**
    
- **T1518 – Discovery**
    

---

# 12. ¿Qué debe dominar un analista al terminar este módulo?

- Interpretar logs de Windows y Linux
    
- Entender Sysmon y PowerShell logging
    
- Detectar árboles de procesos sospechosos
    
- Identificar técnicas de persistencia
    
- Reconocer malware por comportamiento
    
- Ver credenciales robadas
    
- Usar EDR para aislar, matar y analizar
    
- Detectar movimiento lateral desde el endpoint
    
- Correlacionar actividad de host con red
    
- Distinguir actividad legítima de maliciosa