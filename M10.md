# Módulo 10. Servicios de Red (visión SOC)

Los servicios de red representan las “puertas” de los sistemas.  
El atacante los usa para escanear, explotar, moverse o exfiltrar datos.  
El SOC los usa para detectar anomalías y responder incidentes.

Veremos los servicios que más aparecen en ciberseguridad:

1. DNS
    
2. DHCP
    
3. HTTP/HTTPS
    
4. FTP
    
5. SMTP
    
6. NTP
    
7. SSH
    
8. SMB
    
9. RDP
    
10. SNMP
    

Y cómo se ven en herramientas como Zeek, Suricata y Wireshark.

---

# 1. DNS (Domain Name System)

### ¿Qué es?

Traduce nombres a IPs.  
Es el servicio más atacado por su rol crítico y porque no tiene autenticación en consultas.

### Salud normal:

- Consultas tipo A, AAAA, MX, TXT
    
- Frecuencia moderada
    
- Dominio legítimos
    

### Ataques:

- **DNS Tunneling**  
    Exfiltración en campos TXT o longitud excesiva.
    
- **DGA (Domain Generation Algorithms)**  
    Dominios aleatorios generados por malware.
    
- **DNS Poisoning**  
    Manipulación de respuestas.
    
- **Consulta masiva (DNS flood)**
    

### Señales SOC:

- Consultas TXT grandes
    
- Dominios recién creados (NOD)
    
- Frecuencia de consultas por encima de lo normal
    
- Muchas NXDOMAIN
    
- Dominios con nombres aleatorios: dka91jnao01.xyz
    

### Zeek logs:

dns.log con campos:

- query
    
- qtype
    
- answers
    
- TTL
    
- rcode
    

---

# 2. DHCP (Dynamic Host Configuration Protocol)

### ¿Qué hace?

Entrega IP, gateway, DNS y otros parámetros a clientes.

### Ataques:

- Rogue DHCP Server
    
- DHCP starvation
    
- Manipulación de opciones
    
- Redirección (gateway falso)
    

### Señales SOC:

- Servidores DHCP no autorizados
    
- Múltiples solicitudes desde la misma MAC
    
- Opciones DHCP irreales
    

### Zeek logs:

dhcp.log

---

# 3. HTTP / HTTPS

### ¿Qué es?

El servicio más utilizado en la red.  
HTTP → texto plano  
HTTPS → cifrado TLS

### Ataques comunes:

- SQL injection
    
- XSS
    
- CSRF
    
- File inclusion
    
- Directory traversal
    
- Fuerza bruta
    
- Webshells
    
- Malware delivery
    
- C2 oculto en HTTPS
    

### Señales SOC:

- User-Agent sospechoso
    
- URLs excesivamente largas
    
- Peticiones a rutas que no existen
    
- HTTP POST con payload grande
    
- Conexiones constantes (beaconing C2)
    
- Certificados auto-firmados extraños
    
- Cifrado débil o TLS anticuado
    

### Zeek logs:

- http.log
    
- ssl.log
    
- files.log
    

Suricata:

- “ET WEB_SERVER SQL Injection Attempt”
    
- “ET POLICY Suspicious User-Agent”
    

---

# 4. FTP (File Transfer Protocol)

Inseguro, sin cifrado, usa usuario/contraseña visibles.

### Ataques:

- Credential harvesting
    
- Fuerza bruta
    
- Sniffing
    
- Manipulación de archivos
    

### Señales SOC:

- Inicio de sesión fallido repetido
    
- Transferencias de archivos masivas
    
- FTP anónimo habilitado
    
- Uso de PORT/PASV que no coincide con patrón normal
    

Zeek logs:  
ftp.log

---

# 5. SMTP (Simple Mail Transfer Protocol)

Servicio de correo.  
Altamente atacado debido al phishing.

### Ataques:

- Phishing
    
- Malware adjunto
    
- Spoofing
    
- Envío masivo no autorizado (spambot)
    

### Señales SOC:

- Emails salientes excesivos
    
- Adjuntos ejecutables
    
- SMTP HELO/EHLO sospechoso
    
- Conexiones SMTP desde hosts que no deberían enviar correo
    
- Falta de SPF, DKIM o DMARC
    

Zeek logs:  
smtp.log

---

# 6. NTP (Network Time Protocol)

Sincroniza relojes.

### Ataques:

- Amplificación DDoS
    
- Manipulación de tiempo (afecta logs)
    
- Respuesta a peticiones desde cualquier host
    

### Señales SOC:

- Consulta excesiva
    
- Tráfico a port 123 desde muchos orígenes
    
- Respuestas grandes inusuales
    

Zeek logs:  
ntp.log

---

# 7. SSH (Secure Shell)

Servicio crítico para administración.

### Ataques:

- Fuerza bruta
    
- Credential stuffing
    
- Uso de claves comprometidas
    
- Túneles SSH (evasion)
    
- Reverse shell
    

### Señales SOC:

- Muchos intentos fallidos
    
- Logins desde países inesperados
    
- Sesiones largas sin actividad
    
- Túneles SSH en puertos no estándar
    
- Cambios en authorized_keys
    

Logs:

- auth.log (Linux)
    
- Zeek ssh.log
    

---

# 8. SMB (Server Message Block)

Servicio Windows para compartir archivos e impresoras.

### Ataques:

- EternalBlue (MS17-010)
    
- movimiento lateral
    
- Enumeración de recursos
    
- Credential harvesting
    
- SMB relay
    
- Pass-the-Hash
    

### Señales SOC:

- Tráfico SMB entre hosts inesperados
    
- Conexiones a puertos 445/139 desde redes no autorizadas
    
- Mapeos de unidades repetidos
    
- Archivos ejecutables moviéndose por SMB
    

Zeek logs:

- smb_files.log
    
- smb_cmd.log
    

---

# 9. RDP (Remote Desktop Protocol)

Servicio muy sensible.

### Ataques:

- Fuerza bruta
    
- RDP from the internet (crítico)
    
- Credenciales robadas
    
- Screen scrapers
    
- RDP hijacking
    

### Señales SOC:

- Conexiones externas al port 3389
    
- Múltiples fallos de login
    
- Sesiones en horarios inusuales
    
- Tráfico RDP cifrado en túneles no autorizados
    

Logs:

- Microsoft Event Logs
    
- Zeek rdp.log
    

---

# 10. SNMP (Simple Network Management Protocol)

Permite monitorear dispositivos de red.

### Problemas:

- Versiones 1 y 2c sin cifrado
    
- “public” y “private” como strings por defecto
    

### Ataques:

- Enumeración
    
- Cambio de configuración (si se usa RW)
    
- Fuerza bruta
    

### Señales SOC:

- Consultas desde hosts no autorizados
    
- Cambios de parámetro desde IPs inesperadas
    
- Acceso RW detectado
    
- Uso de versión insegura
    

---

# 11. ¿Qué mira realmente un SOC?

Un analista CyberOps examina:

- Frecuencia de consultas DNS
    
- Tiempo de respuesta HTTP
    
- User-agents
    
- Estructura de URLs
    
- Conexiones SSH externas
    
- RDP inesperado
    
- SMB en redes donde no debería existir
    
- Comportamientos anómalos por servicio
    
- Alertas de Suricata/Zeek sobre servicios abusados
    

Estos patrones revelan:

- Phishing
    
- Intrusión
    
- Beaconing
    
- Exfiltración
    
- Malware distribution
    
- Movimiento lateral
    

---

# 12. MITRE ATT&CK asociado

Servicios como vectores de ataque:

- **T1046 – Network Scanning**
    
- **T1071 – Exfiltration via HTTP/HTTPS**
    
- **T1566 – Phishing (SMTP)**
    
- **T1203 – Exploitation for Client Execution**
    
- **T1021 – Remote Services (SSH/RDP/SMB)**
    
- **T1040 – Credential Access via SMB**
    
- **T1048 – Exfiltration over alternative protocols**