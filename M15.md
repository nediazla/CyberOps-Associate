# Módulo 15. Monitorización de las Operaciones de Red (visión SOC)

Monitorización significa recoger información de todos los rincones de la red para detectar anomalías, amenazas y ataques.  
El SOC se alimenta de:

- NetFlow / IPFIX
    
- Logs del sistema
    
- Logs de red
    
- Telemetría NIDS/NIPS
    
- Monitoring servers
    
- Syslog / SNMP
    
- Traffic mirroring (SPAN/TAP)
    
- Data normalization (SIEM)
    

Este módulo enseña cómo se juntan todas esas piezas.

---

# 1. ¿Qué es la monitorización de red?

Es la capacidad de observar:

- Tráfico
    
- Eventos
    
- Estados
    
- Rendimiento
    
- Cambios
    
- Comportamiento
    

Esto permite que un SOC identifique:

- Escaneos
    
- Exfiltración
    
- Beaconing C2
    
- Intrusiones
    
- Fallos de dispositivos
    
- Anomalías
    

---

# 2. Telemetría basada en flujo (NetFlow / IPFIX)

Cisco NetFlow es el estándar de facto (RFC 3954), IPFIX es el sucesor estandarizado.

### ¿Qué captura un flujo?

- IP origen/destino
    
- Puerto origen/destino
    
- Protocolo
    
- Bytes/paquetes
    
- Timestamps
    
- Duración
    
- Flags TCP
    
- Interface de entrada/salida
    

### ¿Qué detecta un SOC?

- Beaconing (conexiones periódicas)
    
- DDoS (volumen anómalo)
    
- Escaneo (muchos destinos, pocos bytes)
    
- Exfiltración (volúmenes altos saliendo)
    
- Movimiento lateral (SMB entre hosts no previstos)
    
- Persistencia de conexiones inusuales
    

NetFlow alimenta SIEM para análisis.

---

# 3. Packet Capture: SPAN vs TAP

### SPAN (Switched Port Analyzer)

Espejo de puertos en un switch.  
Ventaja: fácil, sin hardware extra.  
Desventaja: puede perder paquetes bajo carga.

### TAP (Test Access Point)

Hardware dedicado.  
Ventaja: capture 100% del tráfico.  
Desventaja: requiere instalación física.

### ¿Qué ve un SOC usando captura?

- Flags TCP
    
- Payload HTTP
    
- DNS queries
    
- TLS handshake
    
- Métodos HTTP
    
- Firmas IDS
    
- Artefactos de malware
    

Herramientas:

- Zeek
    
- Suricata
    
- Wireshark
    
- Tcpdump
    

---

# 4. SNMP, Syslog y Telemetría de dispositivos

### SNMP

Monitoriza dispositivos:  
CPU, memoria, interfaces, errores.

### Syslog

El estándar para logs de red.  
Rangos:

- Emergencia (0)
    
- Alerta (1)
    
- Crítico (2)
    
- Error (3)
    
- Warning (4)
    
- Notice (5)
    
- Informativo (6)
    
- Debug (7)
    

Dispositivos envían syslog al SIEM o a Security Onion.

### ¿Qué detecta el SOC?

- Cambios de configuración del router
    
- Cambios de MAC en switches
    
- Flapping de interfaces
    
- CPU alta en firewall
    
- Eventos STP
    
- Violaciones de port-security
    

---

# 5. Logs del sistema operativo

### Windows Event Logs:

- Security
    
- System
    
- Application
    
- PowerShell
    
- Sysmon
    

### Linux logs:

- /var/log/syslog
    
- /var/log/auth.log
    
- journalctl
    
- auditd
    

### Señales SOC importantes:

- 4625 (fallos de autenticación)
    
- 4624 + 4672 (logon con privilegios)
    
- 7045 (creación de servicio)
    
- powerShell 4104 (script ejecutado)
    
- sudo session opened
    
- sshd failed login
    

---

# 6. Logs de servicios de red

### DNS

- Consultas
    
- Respuestas
    
- NXDOMAIN
    
- TXT largos
    

### HTTP

- User-agents
    
- URLs largas
    
- Métodos HTTP raros (OPTIONS, TRACE)
    
- Respuestas 500/404 repetidas
    

### SMTP

- Adjuntos sospechosos
    
- Dominios externos inusuales
    

### SMB

- Acceso a shares no autorizados
    
- Enumeración de recursos
    

---

# 7. NIDS/NIPS (Zeek, Suricata, Snort)

Estos sistemas monitorean el tráfico en tiempo real.

### Zeek

Produce logs estructurados:

- conn.log
    
- dns.log
    
- http.log
    
- ssl.log
    
- smb.log
    
- weird.log
    

### Suricata

Produce:

- EVE alerts
    
- tls
    
- dns
    
- http
    
- flows
    

### ¿Qué detecta un SOC?

- Beaconing
    
- Scanning
    
- Payload malicioso
    
- C2
    
- Evasión
    
- Exploits conocidos
    
- Anomalías de protocolo
    

---

# 8. Normalización y correlación (SIEM)

La telemetría llega cruda.  
Un SIEM:

1. Recibe
    
2. Parse
    
3. Normaliza
    
4. Enrich (TI, geolocalización)
    
5. Correlaciona
    
6. Genera alertas
    
7. Crea dashboards
    

Ejemplos:

- Elastic SIEM
    
- Splunk
    
- QRadar
    
- Wazuh + OpenSearch
    

### Correlaciones típicas:

- 4625 + 3 fallos → brute force
    
- DNS raro + beaconing → malware
    
- HTTP POST grande + conexiones internas -> exfiltración
    
- Run/RunOnce changed + servicio nuevo → persistencia
    
- SMB lateral + RDP fuera de horario → movimiento lateral
    

---

# 9. Análisis de tráfico: comportamiento normal vs ataque

Un analista SOC debe identificar:

### Tráfico normal:

- flujos predecibles
    
- variación horaria
    
- protocolos esperados
    
- destinos legítimos
    

### Tráfico malicioso:

- destinos desconocidos
    
- puertos no estándar
    
- conexiones a intervalos exactos
    
- ratio bytes in/out sospechoso
    
- frecuencia de flujos anómala
    
- patrones repetitivos
    

---

# 10. Alertas de alto valor vs bajo valor

### Alto valor:

- acceso a LSASS
    
- modificación de credenciales
    
- ejecución PowerShell codificada
    
- RDP externo
    
- SMB lateral
    
- DNS tunneling
    
- beaconing
    

### Bajo valor:

- ping
    
- fallos ocasionales de autenticación
    
- tráfico HTTP normal
    

El SOC debe priorizar.

---

# 11. MITRE ATT&CK asociado

- **T1020 – Exfiltration over Network**
    
- **T1040 – Network Sniffing**
    
- **T1059 – Execution**
    
- **T1071 – Application Layer Protocol**
    
- **T1030 – Data Transfer Size**
    
- **T1566 – Phishing**
    
- **T1046 – Network Scanning**
    
- **T1021 – Remote Services**
    
- **T1041 – Exfiltration**
    

---

# 12. ¿Qué domina el analista al terminar este módulo?

- Interpretar NetFlow
    
- Leer conn.log de Zeek
    
- Interpretar alertas Suricata
    
- Analizar syslog y SNMP traps
    
- Detectar comportamiento anómalo
    
- Diferenciar tráfico normal vs malicioso
    
- Correlacionar señales de múltiples fuentes
    
- Entender cómo se recolectan datos
    
- Ver cómo se alimenta un SIEM real